# =============================================
# Railway Deployment Configuration
# ScreenCloud Order Management System - API
# =============================================
#
# This file configures how Railway builds and deploys the API.
# Railway uses Nixpacks to auto-detect Node.js and build the app.
#
# Environment variables (set in Railway dashboard):
# - DATABASE_URL: Auto-provided by Railway PostgreSQL plugin
# - NODE_ENV: production
# - CORS_ORIGIN: Vercel frontend URL
# - PORT: Auto-provided by Railway

[build]
# Use Nixpacks builder (auto-detects Node.js)
builder = "nixpacks"

# Build command (runs during deployment)
buildCommand = "pnpm install --frozen-lockfile && pnpm --filter api exec prisma generate && pnpm --filter api build"

[deploy]
# Start command for the service
startCommand = "pnpm --filter api exec prisma migrate deploy && pnpm --filter api start"

# Health check endpoint (Railway will ping this to verify the app is running)
healthcheckPath = "/health"
healthcheckTimeout = 100

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Number of replicas (1 for free tier)
numReplicas = 1

